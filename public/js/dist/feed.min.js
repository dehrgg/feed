$(document).ready(function(){app.start()});window.app=function(){var n={},r,i,t;return n.models={},n.collections={},n.views={},n.templates={},n.cache={},n.selectors={content:".page-content",emptyMessage:".empty-message",feedItem:".feed-item",feedlistItem:".feedlist-item"},devRoot="/Dehrg/public_html/Text/Feed/public",liveRoot="/demos/feed",r=document.location.host,n.rootUrl=r.indexOf("127.0.0.1")>=0||r.indexOf("localhost")>=0?devRoot:liveRoot,n.stripHTML=function(n,t){var i=t===!0?/<\/?[^b>]>|<\/?[^>\/]{2,}>/g:/<\/?[^>]*>/g;return n.replace(i,"")},i="",t=$("#ajax-modal"),n.start=function(){$(document).ajaxStart(function(){var r=$(".ajax-dialog",t),n=$(".ajax-message",t);r.css("width","auto");t.css("display","block");n.text(i);i?n.removeClass("hide"):n.addClass("hide");r.css("width",$(".ajax-content").outerWidth());t.modal({backdrop:"static"})}).ajaxStop(function(){t.modal("hide");i=""})},n.setAjaxMessage=function(n){i=n},n}();Backbone.View.prototype.close=function(){this.remove();this.unbind();this.onClose&&this.onClose()};Backbone.Model.prototype.parse=Backbone.Collection.prototype.parse=function(n){return n.data&&n.status?JSON.parse(n.data):n};Backbone.View.prototype.isEmpty=function(){return this.$el.html()===""};Backbone.View.prototype.bubble=Backbone.Model.prototype.bubble=function(n){this.listenTo(n,"all",function(){this.trigger.apply(this,arguments)})};app.views.PreRenderedList=Backbone.View.extend({initialize:function(n){this.isEmpty();!n.itemSelector;this.collection||(this.collection=new Backbone.Collection);var t=this.modelConstructor||this.collection.model;_.each($(this.itemSelector,this.el),function(n){var i=this.createModelFromHtml(n,t);this.collection.add(i);this.newItemView(i,n)},this)},createModelFromHtml:function(n,t){var i={};for(var r in this.modelAttributes)i[r]=this.getValue(this.modelAttributes[r],n);return new t(i)},getValue:function(n,t){var u=n.getter||"val",r=$(n.select,t),f=r[u],i=f.apply(r,n.args);return n.integer===!0?parseInt(i,10):n.trim===!1?i:$.trim(i)},checkEmptyMessage:function(){var n=$(app.selectors.emptyMessage,this.el);this.collection.length===0?n.removeClass("hidden"):n.addClass("hidden")}});app.templates=app.templates||{};app.templates.form=new Hogan.Template(function(n,t,i){var r=this;return r.b(i=i||""),r.b('<div class="pin-form">\r'),r.b("\n"+i),r.b('\t<div class="form-group">\r'),r.b("\n"+i),r.b('\t\t<label for="pin-name" class="control-label"> Display Name <\/label>\r'),r.b("\n"+i),r.b('\t\t<input type="text" id="pin-name" name="name" value="'),r.b(r.v(r.f("name",n,t,0))),r.b('" class="form-control">\r'),r.b("\n"+i),r.b("\t<\/div>\r"),r.b("\n"+i),r.b('\t<div class="form-group">\r'),r.b("\n"+i),r.b('\t\t<label for="pin-color" class="control-label"> Color <\/label>\r'),r.b("\n"+i),r.b('\t\t<input type="color" id="pin-color" name="color" value="'),r.b(r.v(r.f("color",n,t,0))),r.b('" class="form-control pin-color-input">\r'),r.b("\n"+i),r.b("\t<\/div>\t\r"),r.b("\n"+i),r.b("<\/div>"),r.fl()});app.templates.picklistItem=new Hogan.Template(function(n,t,i){var r=this;return r.b(i=i||""),r.b('<div class="checkbox picklist--item '),r.s(r.f("full",n,t,1),n,t,0,45,64,"{{ }}")&&(r.rs(n,t,function(n,t,i){i.b("picklist--item-full")}),n.pop()),r.b('">\r'),r.b("\n"+i),r.b("\t<label>\r"),r.b("\n"+i),r.b('\t  <input type="checkbox"'),r.s(r.f("full",n,t,1),n,t,0,121,129,"{{ }}")&&(r.rs(n,t,function(n,t,i){i.b("disabled")}),n.pop()),r.b(">\r"),r.b("\n"+i),r.b('\t  <span class="picklist--list-name">'),r.b(r.v(r.f("name",n,t,0))),r.b("<\/span>\r"),r.b("\n"+i),r.b("\t  "),r.s(r.f("full",n,t,1),n,t,0,209,254,"{{ }}")&&(r.rs(n,t,function(n,t,i){i.b('<span class="label label-warning">Full<\/span>')}),n.pop()),r.b("\r"),r.b("\n"+i),r.b("\t<\/label>\r"),r.b("\n"+i),r.b('\t<input type="hidden" class="picklist--list-id" value="'),r.b(r.v(r.f("id",n,t,0))),r.b('">\r'),r.b("\n"+i),r.b("<\/div>"),r.fl()});app.templates.saved=new Hogan.Template(function(n,t,i){var r=this;return r.b(i=i||""),r.b('<div class="feed-item col-lg-11">\r'),r.b("\n"+i),r.b('\t<div class="row">\r'),r.b("\n"+i),r.b('\t\t<button class="pin-theme btn btn-default col-xs-6 col-sm-7 col-md-9" style="border-color:'),r.b(r.v(r.f("color",n,t,0))),r.b(';">\r'),r.b("\n"+i),r.b('\t\t\t<div class="glyphicon glyphicon-chevron-down feed-item--title-btn pull-left"><\/div>\r'),r.b("\n"+i),r.b('\t\t\t<div class="media-body"> <h5 class="feed-item--name">'),r.b(r.v(r.f("name",n,t,0))),r.b("<\/h5> <\/div>\r"),r.b("\n"+i),r.b("\t\t<\/button>\r"),r.b("\n"+i),r.b('\t\t<input type="hidden" value="'),r.b(r.v(r.f("id",n,t,0))),r.b('" class="feed-item--id">\r'),r.b("\n"+i),r.b('\t\t<input type="hidden" value="'),r.b(r.v(r.d("feed.url",n,t,0))),r.b('" class="feed-item--url">\r'),r.b("\n"+i),r.b('\t\t<input type="hidden" value="'),r.b(r.v(r.f("color",n,t,0))),r.b('" class="feed-item--color">\r'),r.b("\n"+i),r.b('\t\t<div class="btn-group btn-group-borderless col-xs-6 col-sm-5 col-md-3 feed-item--btn-bar">\r'),r.b("\n"+i),r.b('\t\t\t<button class="btn btn-default btn-md" data-usr-action="addlist">\r'),r.b("\n"+i),r.b('\t\t\t\t<span class="glyphicon glyphicon-add-list"><\/span>\r'),r.b("\n"+i),r.b('\t\t\t\t<span class="sr-only">Add to list<\/span>\r'),r.b("\n"+i),r.b("\t\t\t<\/button>\r"),r.b("\n"+i),r.b('\t\t\t<button class="btn btn-default btn-md" data-usr-action="edit">\r'),r.b("\n"+i),r.b('\t\t\t\t<span class="glyphicon glyphicon-pencil"><\/span>\r'),r.b("\n"+i),r.b('\t\t\t\t<span class="sr-only">Edit feed<\/span>\r'),r.b("\n"+i),r.b("\t\t\t<\/button>\r"),r.b("\n"+i),r.b('\t\t\t<button class="btn btn-default btn-md btn-list-remove" data-usr-action="unpin">\r'),r.b("\n"+i),r.b('\t\t\t\t<span class="glyphicon glyphicon-remove"><\/span>\r'),r.b("\n"+i),r.b('\t\t\t\t<span class="sr-only">Unpin Feed<\/span>\r'),r.b("\n"+i),r.b("\t\t\t<\/button>\r"),r.b("\n"+i),r.b("\t\t<\/div>\r"),r.b("\n"+i),r.b("\t<\/div>\r"),r.b("\n"+i),r.b("<\/div>"),r.fl()});app.templates.searchresult=new Hogan.Template(function(n,t,i){var r=this;return r.b(i=i||""),r.b('<div class="feed-item col-md-10 col-md-offset-1">\r'),r.b("\n"+i),r.b("\t<p>\r"),r.b("\n"+i),r.b('\t\t<a href="'),r.b(r.v(r.f("link",n,t,0))),r.b('"> '),r.b(r.t(r.f("name",n,t,0))),r.b(" <\/a> \r"),r.b("\n"+i),r.b("\t\t<br><small> "),r.b(r.t(r.f("snippet",n,t,0))),r.b(" <small>\r"),r.b("\n"+i),r.b("\t<\/p>\r"),r.b("\n"+i),r.b('\t<div class="btn-group btn-group-borderless">\r'),r.b("\n"+i),r.b('\t\t<button class="btn btn-default btn-md" data-usr-action="addlist">\r'),r.b("\n"+i),r.b('\t\t\t<span class="glyphicon glyphicon-add-list"><\/span>\r'),r.b("\n"+i),r.b('\t\t\t<span class="sr-only">Add to list<\/span>\r'),r.b("\n"+i),r.b("\t\t<\/button>\r"),r.b("\n"+i),r.b('\t\t<button class="btn btn-default btn-md" data-usr-action="pin">\r'),r.b("\n"+i),r.b('\t\t\t<span class="glyphicon glyphicon-pushpin"><\/span>\r'),r.b("\n"+i),r.b('\t\t\t<span class="sr-only">Pin<\/span>\r'),r.b("\n"+i),r.b("\t\t<\/button>\r"),r.b("\n"+i),r.b("\t<\/div<\t\r"),r.b("\n"+i),r.b("<\/div>"),r.fl()});app.templates.story=new Hogan.Template(function(n,t,i){var r=this;return r.b(i=i||""),r.b('<a href="'),r.b(r.v(r.f("link",n,t,0))),r.b('" target="_blank" class="story-item btn btn-default row col-xs-12 col-md-10 col-lg-9">\r'),r.b("\n"+i),r.b('\t<h5 class="story-item--title pin-theme col-xs-10 col-md-11" style="border-color:'),r.b(r.v(r.d("pin.color",n,t,0))),r.b(';">\r'),r.b("\n"+i),r.b("\t\t"),r.b(r.v(r.f("title",n,t,0))),r.b("\r"),r.b("\n"+i),r.b("\t\t<br> <small> "),r.b(r.v(r.f("publishedDate",n,t,0))),r.b(" <\/small>\r"),r.b("\n"+i),r.b("\t<\/h5>\r"),r.b("\n"+i),r.b('\t<div class="col-xs-2 col-md-1 story-item--icon">\r'),r.b("\n"+i),r.b('\t\t<span class="glyphicon glyphicon-chevron-right"><\/span>\t\r'),r.b("\n"+i),r.b("\t<\/div>\t\r"),r.b("\n"+i),r.b("<\/a>"),r.fl()});app.templates=app.templates||{};app.templates.listitem=new Hogan.Template(function(n,t,i){var r=this;return r.b(i=i||""),r.b('<li class="feedlist-item"> \r'),r.b("\n"+i),r.b("\t<p>\r"),r.b("\n"+i),r.b('\t<button class="btn btn-list-remove">\r'),r.b("\n"+i),r.b('\t<span class="glyphicon glyphicon-remove"><\/span>\r'),r.b("\n"+i),r.b("\t<\/button>\r"),r.b("\n"+i),r.b('\t<a href="lists/'),r.b(r.v(r.f("id",n,t,0))),r.b('" class="feedlist-item--name btn btn-default">'),r.b(r.v(r.f("name",n,t,0))),r.b("<\/a>\t\r"),r.b("\n"+i),r.b("\t<\/p>\r"),r.b("\n"+i),r.b('\t<input type="hidden" value="'),r.b(r.v(r.f("id",n,t,0))),r.b('" class="feedlist-item--id">\r'),r.b("\n"+i),r.b("<\/li>"),r.fl()});app.models.Feedlist=Backbone.Model.extend({initialize:function(){this.has("pins")||this.set("pins",this.createCollection())},parse:function(){var n=Backbone.Model.prototype.parse.apply(this,arguments),t=n.pins;return t&&(n.pins=this.createCollection(t)),n},validate:function(n){var t={},i;n.name&&n.name.length||(t.name="Name is required");for(i in t)return t},addFeed:function(n){return this.get("pins").add(n)},createFeed:function(n){return this.get("pins").create(n)},createCollection:function(n){return new app.collections.FeedlistFeeds(n,{list:this})}});app.collections.Feedlist=Backbone.Collection.extend({model:app.models.Feedlist,url:function(){return app.rootUrl+"/lists"}});app.models.Feed=Backbone.Model.extend({validate:function(n){var t={},i;n.name&&n.name.length||(t.name="Name is required");for(i in t)return t}});app.collections.FeedlistFeeds=Backbone.Collection.extend({model:app.models.Feed,initialize:function(n,t){this.list=t.list},url:function(){return this.list.url()+"/pins"}});app.collections.UserFeeds=Backbone.Collection.extend({url:function(){return app.rootUrl+"/pins"}});app.views.Search=Backbone.View.extend({subViews:{},events:{"keydown #query":"searchOnEnter"},initialize:function(n){this.feedProvider=n.feedProvider||GoogleFeedProvider;this.collection=new app.collections.UserFeeds;this.listenTo(this.collection,"add",this.createResult);this.listenTo(this.collection,"remove",this.removeResult)},render:function(){var n=this.$("#query").val().trim();return n!=this.query&&(this.clearResults(),this.query=n,n.length>0&&this.feedProvider.findFeeds(n,$.proxy(this.queryResponse,this))),this},queryResponse:function(n){n.error||this.collection.set(n.data)},createResult:function(n){var t=new app.views.Feed({template:app.templates.searchresult,model:n});this.bubble(t);this.subViews[n.cid]=t;this.$("#results").append(t.render().el)},removeResult:function(n){this.subViews[n.cid].close();delete this.subViews[n.cid]},searchOnEnter:function(n){n.keyCode==13&&this.render()},clearResults:function(){_.each(this.subViews,function(n){n.close()});this.subViews.length=0},setProvider:function(n){this.feedProvider=n}});app.views.Picklist=Backbone.View.extend({template:app.templates.picklist,events:{"click #btn-modal-done":"fireAction"},initialize:function(n){this.action=n.action;this.collection=this.collection||new app.collections.Feedlist;_.each($(".picklist--item",this.el),this.createModelFromHtml,this)},createModelFromHtml:function(n){var i=$(".picklist--list-name",n).html(),r=$(".picklist--list-id",n).val(),t=new app.models.Feedlist({name:i,id:r}),u=new app.views.PicklistItem({model:t,el:n});this.collection.add(t)},setAction:function(n){this.action=n},fireAction:function(){var n=this.collection.where({selected:!0});this.action(n)},open:function(){this.$el.modal({backdrop:"static"})}});app.views.PicklistItem=Backbone.View.extend({tagName:"li",template:app.templates.picklistItem,events:{"change :checkbox":"updateModel"},render:function(){var n=this.template.render(this.model.toJSON());return this.setElement(n),this},updateModel:function(n){this.model.set("selected",n.target.checked)}});app.views.FeedIndex=app.views.PreRenderedList.extend({modelAttributes:{url:{select:".feed-item--url"},name:{select:".feed-item--name",getter:"text"},color:{select:".feed-item--color"},id:{select:".feed-item--id",integer:!0}},itemSelector:app.selectors.feedItem,subViews:{},initialize:function(){this.collection=new app.collections.UserFeeds;app.views.PreRenderedList.prototype.initialize.apply(this,arguments);this.listenTo(this.collection,"add",this.feedAdded);this.listenTo(this.collection,"remove",this.feedRemoved)},newItemView:function(n,t){var i=new app.views.Feed({template:app.templates.saved,model:n,el:t});return this.bubble(i),this.subViews[n.id]=i,i},feedAdded:function(){},feedRemoved:function(n){this.subViews[n.id].close();delete this.subViews[n.id];this.checkEmptyMessage()}});app.views.Feed=Backbone.View.extend({initialize:function(n){this.template=n.template;this.listenTo(this.model,"change",this.render)},events:{'click :button[data-usr-action="pin"]':"pinFeed",'click :button[data-usr-action="addlist"]':"openPicklist","click .btn-list-remove":"unpinFeed",'click :button[data-usr-action="edit"]':"editPin"},render:function(){var n=this.template.render(this.model.toJSON());return this.isEmpty()?this.setElement(n):this.$el.html($(n).html()),this},pinFeed:function(){this.model.set({name:app.stripHTML(this.model.get("name"))});app.setAjaxMessage("Pinning feed");this.model.save().done($.proxy(this.pinComplete,this))},unpinFeed:function(){this.model.destroy({wait:!0})},pinComplete:function(n){n.status=="success"?alert("Feed pinned successfully"):n.status=="error"&&alert(n.message)},openPicklist:function(){this.trigger("request.picklist",$.proxy(this.addToLists,this))},addToLists:function(n){_.each(n,function(n){var t=new app.models.Feed({url:this.model.get("url"),name:app.stripHTML(this.model.get("name"))});n.createFeed(t)},this)},editPin:function(){this.trigger("pin.edit",this.model)}});app.views.Feedlists=app.views.PreRenderedList.extend({events:{"click #btn-list-create":"createList","keydown #name-input":"createOnEnter"},modelAttributes:{id:{select:".feedlist-item--id"},name:{select:".feedlist-item--name",getter:"text"}},itemSelector:app.selectors.feedlistItem,subViews:{},initialize:function(){this.collection=new app.collections.Feedlist;app.views.PreRenderedList.prototype.initialize.apply(this,arguments);this.listenTo(this.collection,"add",this.listAdded);this.listenTo(this.collection,"remove",this.listRemoved)},createList:function(){var n=this.$("#name-input"),t=n.val().trim();n.val("");app.setAjaxMessage("Creating list");this.collection.create({name:t},{wait:!0})},newItemView:function(n,t){var i=new app.views.FeedlistItem({model:n,el:t});return this.subViews[n.id]=i,i},listAdded:function(n){var t=this.newItemView(n);this.$("ul").append(t.render().$el);this.checkEmptyMessage()},listRemoved:function(n){this.subViews[n.id].close();delete this.subViews[n.id];this.checkEmptyMessage()},createOnEnter:function(n){n.keyCode==13&&this.createList()}});app.views.FeedlistItem=Backbone.View.extend({template:app.templates.listitem,events:{"click .btn-list-remove":"removeList"},initialize:function(){this.listenTo(this.model,"sync",this.render)},render:function(){var n=this.template.render(this.model.toJSON());return this.isEmpty()?this.setElement(n):this.$el.html($(n).html()),this},removeList:function(){var n=$("#delete-modal"),t=$.proxy(this.deleteModel,this);n.on("click","#btn-modal-delete",t);n.on("hide.bs.modal",function(){n.off()});n.modal({backdrop:"static"})},deleteModel:function(){var n=$.proxy(this.deleteComplete,this);app.setAjaxMessage("Deleting list");this.model.destroy({wait:!0})}});app.views.PinDialog=Backbone.View.extend({template:app.templates.form,events:{"click :button[name='modal-save']":"saveChanges"},initialize:function(){this.$form=this.$(".pin-form")},render:function(){this.$form.html(this.template.render(this.model.toJSON()))},saveChanges:function(){this.updateModel(["#pin-alias","#pin-color"]);this.model.save()},open:function(){this.$el.modal({backdrop:"static"})},updateModel:function(n){for(var i,t=0;t<n.length;++t)i=$(n[t]),this.model.set(i.attr("name"),i.val())},setModel:function(n){this.model=n;this.render()}})